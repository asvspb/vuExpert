# üî¥ Redis –≤–æ VueExpert: –ö—ç—à, —Å—á—ë—Ç—á–∏–∫–∏ –∏ Lua (–£—Ä–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MASTER_PROMPT)

### –ö–æ–Ω—Ç–µ–∫—Å—Ç (–°—é–∂–µ—Ç)
–ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ: –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤, –∑–∞—â–∏—â–∞—Ç—å API –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∏ —Å—á–∏—Ç–∞—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏. Redis –ø–æ–º–æ–∂–µ—Ç, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ –Ω—É–∂–Ω–æ.

### 1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ (–¢–ó)
- Basic: cache-aside –¥–ª—è /products, rate limiter –Ω–∞ IP
- Advanced: —à—Ç–æ—Ä–º –∫—ç—à–∞ (stampede) –∏ Lua, –∫–ª—é—á–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –§–∞–π–ª—ã: `backend/app/main.py`, `backend/app/database.py`
- –ó–∞–¥–∞—á–∞: –¥–æ–±–∞–≤–∏—Ç—å Rate Limiter middleware –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ `/products` —á–µ—Ä–µ–∑ Redis.
- –£—Å–ª–æ–≤–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `redis.asyncio.from_url(..., decode_responses=True)`; TTL –¥–ª—è –∫—ç—à–∞ 60—Å.

### 2. –†–µ—Ñ–µ—Ä–µ–Ω—Å (Visual/Logic Target)
- `/products` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –±–µ—Ä—ë—Ç –∏–∑ –ë–î –∏ –∫–ª–∞–¥—ë—Ç –≤ Redis; –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ ‚Äî –∏–∑ Redis
- Rate Limiter: >10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω ‚Äî `429 Too Many Requests`

### 3. –¢–µ–æ—Ä–∏—è (Just-in-Time)
- In-Memory —Å–∫–æ—Ä–æ—Å—Ç—å, –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å INCR, –∑–∞—á–µ–º decode_responses
- Cache-Aside, –ø—Ä–æ–±–ª–µ–º–∞ Stampede

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞ (Interactive Steps)
–ó–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è:
```py
# middleware.py
async def rate_limiter(request, call_next):
    # ___FILL___: –∫–ª—é—á –ø–æ IP, INCR, EXPIRE, –≤–µ—Ä–Ω—É—Ç—å 429 –µ—Å–ª–∏ –ø–æ—Ä–æ–≥ –ø—Ä–µ–≤—ã—à–µ–Ω

# repository/products.py
async def list_products(db):
    # ___FILL___: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å Redis, –ø–æ—Ç–æ–º –ë–î, –ø–æ—Ç–æ–º –∑–∞–ø–∏—à–∏ –≤ Redis
```

### 5. –ß–µ–∫-–ª–∏—Å—Ç –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ (Verification)
- [ ] –ö—ç—à–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ `/products` –Ω–∞ 60—Å
- [ ] –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã >10/–º–∏–Ω –ø–æ IP
- [ ] –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Redis

### 6. –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ (Troubleshooting)
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –∫–ª–∏–µ–Ω—Ç ‚Üí event loop —Å—Ç–æ–ø–æ—Ä–∏—Ç—Å—è
- –ù–µ–æ—á–∏—â–µ–Ω–Ω—ã–π –∫—ç—à ‚Üí —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á rate limiting ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 7. –†–µ—à–µ–Ω–∏–µ (Spoiler)
<details>
<summary>–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–∞–ª–æ–Ω</summary>

```py
import redis.asyncio as redis
from fastapi import Request, HTTPException

r = redis.from_url('redis://localhost:6379', decode_responses=True)

async def rate_limiter(request: Request, call_next):
    ip = request.client.host
    key = f"rate:{ip}"
    count = await r.incr(key)
    if count == 1:
        await r.expire(key, 60)
    if count > 10:
        raise HTTPException(status_code=429, detail='Too Many Requests')
    return await call_next(request)

async def list_products(db):
    key = 'products:list'
    data = await r.get(key)
    if data:
        return json.loads(data)
    rows = await db.fetch_products()
    await r.setex(key, 60, json.dumps([row.to_dict() for row in rows]))
    return rows
```
</details>

---

–í–æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–∞ –ø–æ **Redis** –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ **VueExpert**.
> –°–º. –ø—Ä–∞–≤–∏–ª–∞ –æ—Ü–µ–Ω–∫–∏: [MODULE_ASSESSMENT.md](./MODULE_ASSESSMENT.md)


### Async‚Äë–ø–∞–π–ø–ª–∞–π–Ω—ã –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```python
import redis.asyncio as redis

r = redis.from_url("redis://localhost:6379", decode_responses=True)

# –ü–∞–π–ø–ª–∞–π–Ω (–±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–º–∞–Ω–¥)
async with r.pipeline(transaction=False) as pipe:
    await pipe.incr("counter")
    await pipe.expire("counter", 60)
    results = await pipe.execute()

# –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è (MULTI/EXEC)
async with r.pipeline(transaction=True) as pipe:
    pipe.set("a", 1)
    pipe.incr("a")
    await pipe.execute()  # –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –ø–∞–∫–µ—Ç–∞
```

–ù–∞—à–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è: **¬´Redis ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫—ç—à. –≠—Ç–æ —à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–π –Ω–æ–∂ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏¬ª**.
–ú—ã —É—á–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –∏ –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π, —Å—á–µ—Ç—á–∏–∫–æ–≤, —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∏ –∑–∞—â–∏—Ç—ã –æ—Ç –∞—Ç–∞–∫ (Rate Limiting). –í —Å–≤—è–∑–∫–µ —Å FastAPI (async) —ç—Ç–æ –¥–∞–µ—Ç –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

---

# üî¥ Redis –≤–æ VueExpert: In-Memory Speed

–ö—É—Ä—Å —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏:
1.  **Basic:** –ü–æ–Ω–∏–º–∞–Ω–∏–µ In-Memory –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, TTL –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Python.
2.  **Advanced:** –°–ª–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (Sorted Sets, Pub/Sub), –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (Lua), –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è. **–ì–∞—Ä–∞–Ω—Ç —É—Ä–æ–≤–Ω—è Middle.**

---

## üü¢ –ß–ê–°–¢–¨ 1. BASIC: –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å
*–¶–µ–ª—å: –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis –≤ Docker, –Ω–∞—É—á–∏—Ç—å—Å—è –ø–∏—Å–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø–æ–Ω–∏–º–∞—Ç—å, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–∞—é—Ç.*

### ‚ö°Ô∏è –ú–æ–¥—É–ª—å R1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ CLI

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- –í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `redis.asyncio.from_url(..., decode_responses=True)`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ bytes.
- Health-check `/health` –ø–∏–Ω–≥—É–µ—Ç Redis (`await redis_client.ping()`) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å.

**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** "–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å vs –ñ–µ—Å—Ç–∫–∏–π –¥–∏—Å–∫" (Ferrari vs –ì—Ä—É–∑–æ–≤–∏–∫).
*   **1.1. In-Memory Concept:**
    *   –ü–æ—á–µ–º—É Redis —Ç–∞–∫–æ–π –±—ã—Å—Ç—Ä—ã–π (—á—Ç–µ–Ω–∏–µ < 1–º—Å).
    *   Single Threaded nature (–ø–æ—á–µ–º—É —ç—Ç–æ —Ñ–∏—á–∞, –∞ –Ω–µ –±–∞–≥).
*   **1.2. Docker Setup:**
    *   –û–±—Ä–∞–∑ `redis:7-alpine`.
    *   `redis-cli`: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É. –ö–æ–º–∞–Ω–¥–∞ `PING` -> `PONG`.
*   **1.3. Key-Value (String):**
    *   `SET user:1 "Alex"`.
    *   `GET user:1`.
    *   –ù–µ–π–º–∏–Ω–≥ –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏–µ (`users:1:name`) ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç.

### ‚è≥ –ú–æ–¥—É–ª—å R2. –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ (TTL)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è.
*   **2.1. Expiration:**
    *   `EXPIRE key 60`. –ö–æ–º–∞–Ω–¥–∞ `TTL`.
    *   `SETEX` (Atomic set + expire).
*   **2.2. –°—Ü–µ–Ω–∞—Ä–∏–∏:**
    *   –ó–∞—á–µ–º —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ? (–û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤, –∫—ç—à).

### üî¢ –ú–æ–¥—É–ª—å R3. –ü—Ä–æ—Å—Ç—ã–µ —Å—á–µ—Ç—á–∏–∫–∏
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞.
*   **3.1. Atomic Increment:**
    *   `INCR view_count`.
    *   –ü–æ—á–µ–º—É `GET` -> `+1` -> `SET` –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–µ (Race Condition), –∞ `INCR` –≤ Redis ‚Äî –Ω–µ—Ç.
*   **3.2. Decrement:**
    *   `DECR`, `INCRBY`.

### üêç –ú–æ–¥—É–ª—å R4. Python Integration (`redis-py`)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** FastAPI.
*   **4.1. Async Client:**
    *   –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `redis.asyncio`.
    *   –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (`ConnectionPool`).
*   **4.2. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    *   –ü—Ä–æ–±–ª–µ–º–∞ `bytes`: Redis –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `b'Alex'`, –∞ –Ω–µ `'Alex'`. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `decode_responses=True`.

---

## üî¥ –ß–ê–°–¢–¨ 2. ADVANCED: System Design Patterns (Middle Grade)
*–¶–µ–ª—å: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, –æ—á–µ—Ä–µ–¥–∏, —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å.*

### üìö –ú–æ–¥—É–ª—å RA1. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
*   **1.1. Lists (–û—á–µ—Ä–µ–¥–∏):**
    *   `LPUSH` / `RPOP`. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á (Task Queue) –¥–ª—è –≤–æ—Ä–∫–µ—Ä–æ–≤.
*   **1.2. Sets (–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å):**
    *   `SADD`, `SISMEMBER`.
    *   *–ö–µ–π—Å:* –•—Ä–∞–Ω–µ–Ω–∏–µ ID –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å). –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤ (`SINTER`) ‚Äî "–û–±—â–∏–µ –¥—Ä—É–∑—å—è".
*   **1.3. Hashes (–û–±—ä–µ–∫—Ç—ã):**
    *   `HSET user:1 name "Alex" age 25`.
    *   –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º JSON-—Å—Ç—Ä–æ–∫–∏.
*   **1.4. Sorted Sets (–†–µ–π—Ç–∏–Ω–≥–∏):**
    *   `ZADD leaderboard 100 "Player1"`.
    *   `ZRANGE` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤. –ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞ Redis.

### üõ°Ô∏è –ú–æ–¥—É–ª—å RA2. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –£—Å–∫–æ—Ä—è–µ–º `GET /products`.
*   **2.1. Cache-Aside Pattern:**
    *   –õ–æ–≥–∏–∫–∞ –≤ Python: "–ï—Å—Ç—å –≤ Redis? –í–µ—Ä–Ω–∏. –ù–µ—Ç? –°—Ö–æ–¥–∏ –≤ Postgres, –∑–∞–ø–∏—à–∏ –≤ Redis, –≤–µ—Ä–Ω–∏".
*   **2.2. Cache Stampede (Dogpile):**
    *   –ü—Ä–æ–±–ª–µ–º–∞: –ö—ç—à –∏—Å—Ç–µ–∫, –∏ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —É–¥–∞—Ä–∏–ª–∏ –≤ –ë–î.
    *   –†–µ—à–µ–Ω–∏–µ: Probabilistic Early Expiration –∏–ª–∏ Locking.
*   **2.3. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:**
    *   –°–∞–º–∞—è —Å–ª–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ IT. –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –∫—ç—à —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤, –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Ü–µ–Ω–∞ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞?

### ‚öõÔ∏è –ú–æ–¥—É–ª—å RA3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ Lua
**–ö—Ä–∏—Ç–µ—Ä–∏–π –ú–∏–¥–ª–∞:** –£–º–µ—Ç—å –ø–∏—Å–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã.
*   **3.1. Pipeline:**
    *   –û—Ç–ø—Ä–∞–≤–∫–∞ 100 –∫–æ–º–∞–Ω–¥ –∑–∞ –æ–¥–∏–Ω —Å–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å (Batching). –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ —Ä–∞–∑—ã.
*   **3.2. Lua Scripts (`EVAL`):**
    *   –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ "–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ Redis".
    *   *–ö–µ–π—Å:* Rate Limiter (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–æ–≤). –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –∏ —É–≤–µ–ª–∏—á–∏—Ç—å –µ–≥–æ –∞—Ç–æ–º–∞—Ä–Ω–æ. –ù–∏–∫–∞–∫–æ–π Race Condition –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.

### üì° –ú–æ–¥—É–ª—å RA4. Pub/Sub (Real-time)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ß–∞—Ç.
*   **4.1. Publisher / Subscriber:**
    *   `SUBSCRIBE channel_1`.
    *   `PUBLISH channel_1 "Hello"`.
    *   –û—Ç–ª–∏—á–∏–µ –æ—Ç –æ—á–µ—Ä–µ–¥–µ–π: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—é—Ç –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ (Fire and Forget).
*   **4.2. –°–≤—è–∑—å —Å WebSockets:**
    *   –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ FastAPI —á–µ—Ä–µ–∑ Redis Pub/Sub.

### üíæ –ú–æ–¥—É–ª—å RA5. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
*   **5.1. Persistence (RDB vs AOF):**
    *   RDB (–°–Ω—ç–ø—à–æ—Ç—ã): –ë—ã—Å—Ç—Ä–æ, –Ω–æ –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç.
    *   AOF (–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π): –ù–∞–¥–µ–∂–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ—Å—Ç–∞—Ä—Ç.
    *   –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –∫—ç—à–∞, –∞ —á—Ç–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π.
*   **5.2. Eviction Policies (–í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ):**
    *   –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –ø–∞–º—è—Ç—å (RAM) –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è?
    *   `allkeys-lru` (—É–¥–∞–ª—è–π —Å—Ç–∞—Ä–æ–µ) vs `volatile-lru` (—É–¥–∞–ª—è–π —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Å TTL) vs `noeviction` (–≤–µ—Ä–Ω–∏ –æ—à–∏–±–∫—É).

### üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω Redis (Middle Project)
**–ó–∞–¥–∞–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å **"Rate Limiter & Leaderboard"**.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1.  **Middleware:** –í FastAPI –Ω–∞–ø–∏—Å–∞—Ç—å middleware, –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç IP, –µ—Å–ª–∏ –æ–Ω –¥–µ–ª–∞–µ—Ç –±–æ–ª—å—à–µ 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis (Key: `rate:ip:127.0.0.1`, TTL: 60).
2.  **Lua Script:** –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –ª–∏–º–∏—Ç–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ Lua-—Å–∫—Ä–∏–ø—Ç–µ –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏.
3.  **Leaderboard:** API —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /score`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—á–∫–∏ —é–∑–µ—Ä–∞ –≤ Sorted Set.
4.  **Top Players:** –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /top`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Ç–æ–ø-3 —é–∑–µ—Ä–æ–≤ —Å –æ—á–∫–∞–º–∏.
5.  **Optimization:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Pipeline` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏—à–∫–∏ –≤ –£—á–µ–±–Ω–∏–∫–µ

1.  **TTL Bomb Visualizer:**
    *   –°—Ç—É–¥–µ–Ω—Ç –ø–∏—à–µ—Ç `SETEX key 10 value`.
    *   –ü–æ—è–≤–ª—è–µ—Ç—Å—è "–±–æ–º–±–∞" —Å —Ç–∞–π–º–µ—Ä–æ–º 10..9..8.
    *   –°—Ç—É–¥–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å `GET`.
    *   –ï—Å–ª–∏ —É—Å–ø–µ–ª ‚Äî –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ. –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –Ω–∞ 0 ‚Äî –±–æ–º–±–∞ –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è, `GET` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nil`.

2.  **Pipeline Racer:**
    *   –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–≤—É—Ö –¥–æ—Ä–æ–∂–µ–∫.
    *   –î–æ—Ä–æ–∂–∫–∞ 1 (–û–±—ã—á–Ω–∞—è): –ú–∞—à–∏–Ω–∫–∞ –µ–¥–µ—Ç —Ç—É–¥–∞-—Å—é–¥–∞ 10 —Ä–∞–∑ (10 –∫–æ–º–∞–Ω–¥).
    *   –î–æ—Ä–æ–∂–∫–∞ 2 (Pipeline): –ì—Ä—É–∑–æ–≤–∏–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç 10 –∫–æ—Ä–æ–±–æ–∫ –∏ –µ–¥–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑.
    *   –ù–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–∫–æ–Ω–æ–º–∏—é –Ω–∞ RTT (Round Trip Time).

3.  **Lua Sandbox:**
    *   –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞, –≥–¥–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–∞ Lua.
    *   –ö–Ω–æ–ø–∫–∞ "Execute Atomic".
    *   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∏–∫—Ç–æ –¥—Ä—É–≥–æ–π (–¥—Ä—É–≥–∏–µ "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" —Å–∏–º—É–ª—è—Ç–æ—Ä–∞) –Ω–µ –º–æ–≥—É—Ç –∑–∞–ø–∏—Å–∞—Ç—å –≤ –±–∞–∑—É.

4.  **Eviction Simulator:**
    *   –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ "–ü–∞–º—è—Ç—å" (–∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞ 90%).
    *   –°—Ç—É–¥–µ–Ω—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∫–ª—é—á–∏.
    *   –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫ "—Å—Ç–∞—Ä—ã–µ" (—Å–∏–Ω–∏–µ) –±–ª–æ–∫–∏ –≤—ã–ø–∞–¥–∞—é—Ç –∏–∑ –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã —É—Å—Ç—É–ø–∏—Ç—å –º–µ—Å—Ç–æ "–Ω–æ–≤—ã–º" (–∑–µ–ª–µ–Ω—ã–º), —Ä–∞–±–æ—Ç–∞—è –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É LRU.

## –û—Ü–µ–Ω–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

- –ö–≤–∏–∑ (—Ç–µ–æ—Ä–∏—è)
  - –§–æ—Ä–º–∞—Ç: 10-20 –≤–æ–ø—Ä–æ—Å–æ–≤ (JSON/YAML/Markdown‚Äë–±–∞–Ω–∫).
  - –ü–æ—Ä–æ–≥ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: ‚â• 80% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.
- –ü—Ä–∞–∫—Ç–∏–∫–∞ (–∫–æ–¥/–∑–∞–¥–∞—á–∏)
  - –†–µ–ø–æ‚Äë–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (–≤–Ω–æ—Å—è—Ç—Å—è –≤ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç).
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: unit/integration/e2e —Ç–µ—Å—Ç–∞–º–∏.
- –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ (CI)
  - –§—Ä–æ–Ω—Ç: Vitest (+ –ø–æ–∫—Ä—ã—Ç–∏–µ), –ª–∏–Ω—Ç–µ—Ä—ã (ESLint/Prettier).
  - –ë—ç–∫: Pytest (httpx.AsyncClient), –ª–∏–Ω—Ç–µ—Ä—ã (ruff/flake8), –ø–æ–∫—Ä—ã—Ç–∏–µ.
  - E2E: Playwright (PW_BASE_URL).
- –†—É–±—Ä–∏–∫–∞
  - S (90‚Äì100): —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ, —Å—Ç–∏–ª—å —á–∏—Å—Ç—ã–π, –±–µ–∑ smell‚Äë–æ–≤.
  - A (80‚Äì89), B (70‚Äì79), C (<70) ‚Äî –ø–æ —É–±—ã–≤–∞–Ω–∏—é: –Ω–µ–¥–æ—á—ë—Ç—ã/–ø–æ–∫—Ä—ã—Ç–∏–µ/–ø–∞–¥–∞—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
- Remediation
  - –°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–∞–ª–æ–≤ (–∏–∑ –æ—Ç—á—ë—Ç–∞ CI) ‚Üí —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã —É—á–µ–±–Ω–∏–∫–∞.
