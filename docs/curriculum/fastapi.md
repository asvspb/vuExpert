# ‚ö°Ô∏è FastAPI –≤–æ VueExpert: –°–∫–æ—Ä–æ—Å—Ç—å –∏ –¢–∏–ø–∏–∑–∞—Ü–∏—è (–£—Ä–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MASTER_PROMPT)

### –ö–æ–Ω—Ç–µ–∫—Å—Ç (–°—é–∂–µ—Ç)
–¢—ã –ø–æ–¥–∫–ª—é—á–∞–µ—à—å —Ñ—Ä–æ–Ω—Ç –Ω–∞ Vue –∫ –±—ç–∫–µ–Ω–¥—É –Ω–∞ FastAPI. –ü—Ä–æ–¥–∞–∫—à–Ω-–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Ç—Ä–µ–±—É–µ—Ç –≤–∏–¥–∏–º–æ–≥–æ health-check: —Ñ—Ä–æ–Ω—Ç –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ–ª–∂–Ω—ã –ø–æ–Ω–∏–º–∞—Ç—å, –∂–∏–≤—ã –ª–∏ Redis –∏ –±–∞–∑–∞. –ë–µ–∑ —ç—Ç–æ–≥–æ DevOps –∏ QA –º—É—á–∞—é—Ç—Å—è, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.

### 1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ (–¢–ó)
- Basic: —ç–Ω–¥–ø–æ–∏–Ω—Ç /health —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Redis/DB, 200/503
- Advanced: —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏/–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞, —Ç–∞–π–º–∞—É—Ç—ã/—Ä–µ—Ç—Ä–∞–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –§–∞–π–ª—ã: `backend/app/main.py`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `backend/app/database.py`
- –ó–∞–¥–∞—á–∞: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /health`, –∫–æ—Ç–æ—Ä—ã–π:
  - –ü–∏–Ω–≥—É–µ—Ç Redis (PING)
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (SQLite —Å–µ–π—á–∞—Å; –¥–∞–ª–µ–µ ‚Äî PostgreSQL) —á–µ—Ä–µ–∑ `engine.begin()` –∏ –ø—Ä–æ—Å—Ç–æ–π `SELECT 1`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON `{ redis: 'ok'|'fail', db: 'ok'|'fail' }` –∏ `200 OK`, –µ—Å–ª–∏ –æ–±–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ok; –∏–Ω–∞—á–µ `503 Service Unavailable`
- –£—Å–ª–æ–≤–∏—è: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –±–µ–∑ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ—é—â–∏–π—Å—è DI-–ø–æ–¥—Ö–æ–¥ –∫ —Å–µ—Å—Å–∏–∏.

### 2. –†–µ—Ñ–µ—Ä–µ–Ω—Å (Visual/Logic Target)
- –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:
```
HTTP/1.1 200 OK
{
  "redis": "ok",
  "db": "ok"
}
```
- –ü—Ä–∏–º–µ—Ä –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ Redis:
```
HTTP/1.1 503 Service Unavailable
{
  "redis": "fail",
  "db": "ok"
}
```

### 3. –¢–µ–æ—Ä–∏—è (Just-in-Time)
- FastAPI = ASGI, –∑–Ω–∞—á–∏—Ç –≤—ã–∑–æ–≤—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å async, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å event loop
- –ü–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞: –¥–µ—Ä–∂–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω–Ω–µ–∫—Ç—ã –±–µ–∑ graceful-handling ‚Äî –Ω–∞ –ø–∞–¥–µ–Ω–∏–µ Redis –Ω–∞–¥–æ –æ—Ç–≤–µ—á–∞—Ç—å 503, –∞ –Ω–µ 500
- DI (Depends) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω–∂–µ–∫—Ç–∏—Ç—å —Å–µ—Å—Å–∏—é –ë–î –∏ –º–æ–∫–∞—Ç—å –µ—ë –≤ —Ç–µ—Å—Ç–∞—Ö

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞ (Interactive Steps)
–®–∞–≥–∏ ‚Äî –∏—Å–ø—Ä–∞–≤—å ¬´—Å–ª–æ–º–∞–Ω–Ω—ã–π –∫–æ–¥¬ª –∏ –∑–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ–ø—É—Å–∫–∏, –Ω–µ –∫–æ–ø–∏—Ä—É—è —Ü–µ–ª–∏–∫–æ–º —Ä–µ—à–µ–Ω–∏–µ.
1) –≠–Ω–¥–ø–æ–∏–Ω—Ç
- –í `backend/app/main.py` –¥–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
```py
@router.get("/health")
async def health():
    redis_ok = False
    db_ok = False
    # TODO: –≤—ã–ø–æ–ª–Ω–∏—Ç—å async ping Redis -> redis_ok = True/False
    # TODO: –≤—ã–ø–æ–ª–Ω–∏—Ç—å SELECT 1 —á–µ—Ä–µ–∑ async engine -> db_ok = True/False
    status_code = 200 if (redis_ok and db_ok) else 503
    return JSONResponse({"redis": "ok" if redis_ok else "fail", "db": "ok" if db_ok else "fail"}, status_code=status_code)
```
- –ü–æ–¥–∫–ª—é—á–∏ router –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω.

2) Redis ping
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–∫–ª–∏–µ–Ω—Ç Redis –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π). –ü—Ä–∏–º–µ—Ä–Ω–æ:
```py
try:
    # ___FILL_ASYNC_REDIS_PING___
    redis_ok = True
except Exception:
    redis_ok = False
```

3) DB check
- –í—ã–ø–æ–ª–Ω–∏ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å:
```py
try:
    async with engine.begin() as conn:
        await conn.execute(text("SELECT 1"))  # –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π text –∏–∑ SQLAlchemy
    db_ok = True
except Exception:
    db_ok = False
```

4) –¢–µ—Å—Ç (AsyncClient)
- –í `backend/tests/test_health.py` —Å–æ–∑–¥–∞–π —Ç–µ—Å—Ç —Å httpx.AsyncClient:
```py
async def test_health_ok(async_client):
    res = await async_client.get("/health")
    assert res.status_code in (200, 503)
    payload = res.json()
    assert set(payload.keys()) == {"redis", "db"}
```
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –∑–∞–º–æ–∫–∞–π Redis/DB, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–µ –≤–µ—Ç–∫–∏ (ok/fail).

### 5. –ß–µ–∫-–ª–∏—Å—Ç –°–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ (Verification)
- [ ] `/health` –æ—Ç–¥–∞—ë—Ç JSON —Å –ø–æ–ª—è–º–∏ `redis`, `db`
- [ ] –ü—Ä–∏ –æ—à–∏–±–∫–µ Redis/DB –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ = 503
- [ ] –ù–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤ (async everywhere)
- [ ] –¢–µ—Å—Ç—ã httpx.AsyncClient –∑–µ–ª—ë–Ω—ã–µ

### 6. –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ (Troubleshooting)
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Redis ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ event loop. –ò—Å–ø–æ–ª—å–∑—É–π async-–∫–ª–∏–µ–Ω—Ç
- –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ `text` –∏–∑ SQLAlchemy ‚Üí –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π `from sqlalchemy import text`
- –ó–∞–±—ã–ª–∏ `await` ‚Üí –∫–æ—Ä—É—Ç–∏–Ω—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, —Å—Ç–∞—Ç—É—Å –≤—Å–µ–≥–¥–∞ 503
- –£—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π `async with engine.begin()`

### 7. –†–µ—à–µ–Ω–∏–µ (Spoiler)
<details>
<summary>–ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–∞–ª–æ–Ω</summary>

```py
from fastapi import APIRouter
from fastapi.responses import JSONResponse
from sqlalchemy import text
from .database import engine, get_redis  # –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

router = APIRouter()

@router.get("/health")
async def health():
    redis_ok = False
    db_ok = False
    # Redis
    try:
        r = await get_redis()
        pong = await r.ping()
        redis_ok = bool(pong)
    except Exception:
        redis_ok = False
    # DB
    try:
        async with engine.begin() as conn:
            await conn.execute(text("SELECT 1"))
        db_ok = True
    except Exception:
        db_ok = False
    status_code = 200 if (redis_ok and db_ok) else 503
    return JSONResponse({
        "redis": "ok" if redis_ok else "fail",
        "db": "ok" if db_ok else "fail"
    }, status_code=status_code)
```
</details>

---

–í–æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–∞ –ø–æ **FastAPI** –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ **VueExpert**.
> –°–º. –ø—Ä–∞–≤–∏–ª–∞ –æ—Ü–µ–Ω–∫–∏: [MODULE_ASSESSMENT.md](./MODULE_ASSESSMENT.md)


FastAPI —Å–µ–≥–æ–¥–Ω—è ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –¥–ª—è Python-–±—ç–∫–µ–Ω–¥–∞.
–ù–∞—à–∞ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è: **¬´FastAPI ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–æ—É—Ç–∏–Ω–≥–∞. –≠—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–¥–µ–∂–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –º–µ–∂–¥—É –§—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ –ë—ç–∫–µ–Ω–¥–æ–º¬ª**.

–ú—ã –¥–µ–ª–∞–µ–º —É–ø–æ—Ä –Ω–∞ **Pydantic v2** (–≤–∞–ª–∏–¥–∞—Ü–∏—è), **Dependency Injection** (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞) –∏ **Async** (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å).

---

# ‚ö°Ô∏è FastAPI –≤–æ VueExpert: –°–∫–æ—Ä–æ—Å—Ç—å –∏ –¢–∏–ø–∏–∑–∞—Ü–∏—è

–ö—É—Ä—Å —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –¥–≤–µ —á–∞—Å—Ç–∏:
1.  **Basic:** –°–æ–∑–¥–∞–Ω–∏–µ REST API, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger –∏ —Å–≤—è–∑—å —Å Vue.
2.  **Advanced:** –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (JWT), WebSockets, —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏ DI. **–ì–∞—Ä–∞–Ω—Ç —É—Ä–æ–≤–Ω—è Middle.**

---

## üü¢ –ß–ê–°–¢–¨ 1. BASIC: –°—Ç—Ä–æ–∏–º REST API
*–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞–µ—Ç –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JSON, –Ω–µ –ø–∞–¥–∞–µ—Ç –æ—Ç –∫—Ä–∏–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–Ω—è—Ç–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.*

### üöÄ –ú–æ–¥—É–ª—å F1. –°—Ç–∞—Ä—Ç –∏ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–ú–µ—Ç–∞—Ñ–æ—Ä–∞:** "–°–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥".
*   **1.1. Hello World:**
    *   `FastAPI` –∏–Ω—Å—Ç–∞–Ω—Å. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@app.get`.
    *   –°–µ—Ä–≤–µ—Ä `Uvicorn`: ASGI vs WSGI (–ø–æ—á–µ–º—É FastAPI –±—ã—Å—Ç—Ä—ã–π).
*   **1.2. Interactive Docs (Killer Feature):**
    *   `/docs` (Swagger UI) –∏ `/redoc`.
    *   –ó–∞—á–µ–º –ø–∏—Å–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º (`summary`, `description`).
    *   *–ü—Ä–∞–∫—Ç–∏–∫–∞:* –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏ —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.

### üì• –ú–æ–¥—É–ª—å F2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
*   **2.1. Path Parameters:**
    *   `/items/{item_id}`. –¢–∏–ø–∏–∑–∞—Ü–∏—è `item_id: int`.
    *   –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–∏ (FastAPI —Å–∞–º –≤–µ—Ä–Ω–µ—Ç 422, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –±—É–∫–≤—ã –≤–º–µ—Å—Ç–æ —Ü–∏—Ñ—Ä).
*   **2.2. Query Parameters:**
    *   `/items?skip=0&limit=10`. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    *   –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`q: str | None = None`).

### üõ°Ô∏è –ú–æ–¥—É–ª—å F3. Pydantic v2 (–©–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
**–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.**
*   **3.1. Request Body:**
    *   –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ `class ItemCreate(BaseModel)`.
    *   –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π: `str`, `int`, `HttpUrl`, `EmailStr`.
*   **3.2. –í–∞–ª–∏–¥–∞—Ü–∏—è:**
    *   `Field(..., gt=0)`: –¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0.
    *   `Field(..., min_length=3)`: –ò–º—è –Ω–µ –∫–æ—Ä–æ—á–µ 3 –±—É–∫–≤.
    *   –ß—Ç–æ —Ç–∞–∫–æ–µ `422 Unprocessable Entity` –∏ –∫–∞–∫ –µ–≥–æ —á–∏—Ç–∞—Ç—å.

### üì§ –ú–æ–¥—É–ª—å F4. –û—Ç–≤–µ—Ç—ã –∏ –û—à–∏–±–∫–∏
*   **4.1. Response Model:**
    *   –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π: `UserCreate` (—Å –ø–∞—Ä–æ–ª–µ–º) –∏ `UserResponse` (–±–µ–∑ –ø–∞—Ä–æ–ª—è).
    *   –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `response_model=UserResponse`.
*   **4.2. HTTP Status Codes:**
    *   –ó–∞—á–µ–º –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `201 Created` –≤–º–µ—Å—Ç–æ `200 OK`.
    *   `HTTPException`: –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫–∏ (`404 Not Found`).

### üåê –ú–æ–¥—É–ª—å F5. –°–≤—è–∑—å —Å Vue (CORS)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º.
*   **5.1. CORS Middleware:**
    *   –ü–æ—á–µ–º—É –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å `localhost:5173` –Ω–∞ `localhost:8000`.
    *   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `allow_origins` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ –ø—Ä–æ–µ–∫—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã `http://localhost:5173` –∏ `http://localhost:4173`).
*   **5.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
    *   –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å –≤—Å—ë –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ `main.py`.

---

## üî¥ –ß–ê–°–¢–¨ 2. ADVANCED: Production Grade (Middle Grade)
*–¶–µ–ª—å: –ü–∏—Å–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –∫–æ–¥. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è.*

### üíâ –ú–æ–¥—É–ª—å FA1. Dependency Injection (DI)
**–°–µ—Ä–¥—Ü–µ FastAPI.**
*   **1.1. –û—Å–Ω–æ–≤—ã `Depends`:**
    *   –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ª–æ–≥–∏–∫–∏.
    *   –ü—Ä–∏–º–µ—Ä: –§—É–Ω–∫—Ü–∏—è `common_parameters` –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.
*   **1.2. Database Session DI:**
    *   –ü–∞—Ç—Ç–µ—Ä–Ω `get_db`. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏ SQLAlchemy –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
*   **1.3. User Injection:**
    *   `get_current_user`. –ü–æ–ª—É—á–µ–Ω–∏–µ —é–∑–µ—Ä–∞ –∏–∑ —Ç–æ–∫–µ–Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π: `user: User = Depends(get_current_user)`.

### üèóÔ∏è –ú–æ–¥—É–ª—å FA2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (APIRouter)
*   **2.1. –†–æ—É—Ç–µ—Ä—ã:**
    *   –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏: `users.py`, `items.py`, `auth.py`.
    *   –ü—Ä–µ—Ñ–∏–∫—Å—ã (`/api/v1`) –∏ —Ç–µ–≥–∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ Swagger.
*   **2.2. Service Layer (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
    *   –í—ã–Ω–æ—Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (—Ä–æ—É—Ç–æ–≤) –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

### üîê –ú–æ–¥—É–ª—å FA3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ Auth (JWT)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –≤ VueExpert.
*   **3.1. OAuth2 Password Bearer:**
    *   –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–ª–æ—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –§–æ—Ä–º–∞ `username` + `password`.
*   **3.2. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π:**
    *   –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `Passlib` + `Bcrypt`. –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.
*   **3.3. JWT –¢–æ–∫–µ–Ω—ã:**
    *   –°–æ–∑–¥–∞–Ω–∏–µ (access token), –ø–æ–¥–ø–∏—Å—å (SECRET_KEY), –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (expiration).
    *   –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

### üì° –ú–æ–¥—É–ª—å FA4. WebSockets (Real-time)
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞.
*   **4.1. Endpoint `ws://`:**
    *   –û—Ç–ª–∏—á–∏—è –æ—Ç HTTP. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
*   **4.2. Connection Manager:**
    *   –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ —Ä–∞—Å—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (Broadcast).
    *   *–ü—Ä–∞–∫—Ç–∏–∫–∞ VueExpert:* –°–¥–µ–ª–∞—Ç—å —á–∞—Ç —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏.

### üï∞Ô∏è –ú–æ–¥—É–ª—å FA5. Background Tasks & Middleware
*   **5.1. –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:**
    *   `BackgroundTasks`. –û—Ç–ø—Ä–∞–≤–∫–∞ email *–ø–æ—Å–ª–µ* –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å –µ–≥–æ –∂–¥–∞—Ç—å).
*   **5.2. Middlewares:**
    *   –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
    *   –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (Process Time Header).

### üß™ –ú–æ–¥—É–ª—å FA6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (AsyncClient)

–ü—Ä–∞–∫—Ç–∏–∫–∞: Health-check –∏ AsyncClient
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ `/health`, –∫–æ—Ç–æ—Ä—ã–π –ø–∏–Ω–≥—É–µ—Ç Redis –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å SQLite —á–µ—Ä–µ–∑ `engine.begin()` (—Å–º. —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –≤ `backend/app/main.py`).
- –ù–∞–ø–∏—à–∏—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å `httpx.AsyncClient` –∏ –ø–æ–¥–º–µ–Ω–æ–π `get_db` –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é SQLite (`app.dependency_overrides`).
*   **6.1. `httpx` vs `TestClient`:**
    *   –ü–æ—á–µ–º—É –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω—É–∂–µ–Ω `AsyncClient`.
*   **6.2. Override Dependencies:**
    *   –ì–ª–∞–≤–Ω–∞—è —Ñ–∏—à–∫–∞ DI –≤ —Ç–µ—Å—Ç–∞—Ö. –ü–æ–¥–º–µ–Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é SQLite –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ—á–∫—É —á–µ—Ä–µ–∑ `app.dependency_overrides`.

### üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫–∑–∞–º–µ–Ω FastAPI (Middle Project)
**–ó–∞–¥–∞–Ω–∏–µ:** –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **Backend –¥–ª—è CRM-—Å–∏—Å—Ç–µ–º—ã**.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1.  **Auth:** –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ª–æ–≥–∏–Ω–∞ —Å JWT.
2.  **RBAC (Roles):** –î–µ–∫–æ—Ä–∞—Ç–æ—Ä, –ø—É—Å–∫–∞—é—â–∏–π –∫ —Ä—É—á–∫–µ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤.
3.  **Files:** –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (`UploadFile`), –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∞.
4.  **Async DB:** PostgreSQL + SQLAlchemy.
5.  **DI:** –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ –ë–î.
6.  **Tests:** –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è –ø–æ–∫—É–ø–∫–∏.

---

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏—à–∫–∏ –≤ –£—á–µ–±–Ω–∏–∫–µ

1.  **Swagger Challenge:**
    *   –í–Ω—É—Ç—Ä–∏ —É—á–µ–±–Ω–∏–∫–∞ –≤—Å—Ç—Ä–æ–µ–Ω —Ñ—Ä–µ–π–º —Å–æ Swagger UI.
    *   **–ó–∞–¥–∞–Ω–∏–µ:** "–ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É Authorize (–ø–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω), –∞ –∑–∞—Ç–µ–º —Å–¥–µ–ª–∞–π –∑–∞–ø—Ä–æ—Å –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É —Ä–æ—É—Ç—É `/users/me`".
    *   –≠—Ç–æ —É—á–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –æ—Ç–ª–∞–¥–∫–∏.

2.  **Pydantic Validator Playground:**
    *   –ü–æ–ª–µ –≤–≤–æ–¥–∞ JSON.
    *   –ü–æ–ª–µ –≤–≤–æ–¥–∞ Pydantic-—Å—Ö–µ–º—ã (Python –∫–æ–¥).
    *   –ö–Ω–æ–ø–∫–∞ "Validate".
    *   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –ø—Ä–æ—à–µ–ª –ª–∏ JSON –≤–∞–ª–∏–¥–∞—Ü–∏—é, –∏–ª–∏ –≤—ã–≤–æ–¥–∏—Ç –∫—Ä–∞—Å–∏–≤—É—é –æ—à–∏–±–∫—É `Field required`.

3.  **Dependency Graph Visualizer:**
    *   –°—Ç—É–¥–µ–Ω—Ç –ø–∏—à–µ—Ç –∫–æ–¥ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ `Depends`.
    *   –£—á–µ–±–Ω–∏–∫ —Ä–∏—Å—É–µ—Ç –≥—Ä–∞—Ñ: `Route` -> `get_current_user` -> `oauth2_scheme`.
    *   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—Ç —á–µ—Ä–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

4.  **CORS Simulator:**
    *   –î–≤–∞ "–±—Ä–∞—É–∑–µ—Ä–∞" –Ω–∞ —ç–∫—Ä–∞–Ω–µ.
    *   –û–¥–∏–Ω –Ω–∞ `localhost:3000`, –¥—Ä—É–≥–æ–π –Ω–∞ `google.com`.
    *   –°—Ç—É–¥–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç `allow_origins`.
    *   –í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫ –∑–∞–ø—Ä–æ—Å –æ—Ç Google –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è "—Å—Ç–µ–Ω–æ–π" CORS, –∞ –∑–∞–ø—Ä–æ—Å –æ—Ç Localhost –ø—Ä–æ—Ö–æ–¥–∏—Ç.

## –û—Ü–µ–Ω–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

- –ö–≤–∏–∑ (—Ç–µ–æ—Ä–∏—è)
  - –§–æ—Ä–º–∞—Ç: 10-20 –≤–æ–ø—Ä–æ—Å–æ–≤ (JSON/YAML/Markdown‚Äë–±–∞–Ω–∫).
  - –ü–æ—Ä–æ–≥ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è: ‚â• 80% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.
- –ü—Ä–∞–∫—Ç–∏–∫–∞ (–∫–æ–¥/–∑–∞–¥–∞—á–∏)
  - –†–µ–ø–æ‚Äë–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (–≤–Ω–æ—Å—è—Ç—Å—è –≤ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç).
  - –ü—Ä–æ–≤–µ—Ä–∫–∞: unit/integration/e2e —Ç–µ—Å—Ç–∞–º–∏.
- –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ (CI)
  - –§—Ä–æ–Ω—Ç: Vitest (+ –ø–æ–∫—Ä—ã—Ç–∏–µ), –ª–∏–Ω—Ç–µ—Ä—ã (ESLint/Prettier).
  - –ë—ç–∫: Pytest (httpx.AsyncClient), –ª–∏–Ω—Ç–µ—Ä—ã (ruff/flake8), –ø–æ–∫—Ä—ã—Ç–∏–µ.
  - E2E: Playwright (PW_BASE_URL).
- –†—É–±—Ä–∏–∫–∞
  - S (90‚Äì100): —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ, —Å—Ç–∏–ª—å —á–∏—Å—Ç—ã–π, –±–µ–∑ smell‚Äë–æ–≤.
  - A (80‚Äì89), B (70‚Äì79), C (<70) ‚Äî –ø–æ —É–±—ã–≤–∞–Ω–∏—é: –Ω–µ–¥–æ—á—ë—Ç—ã/–ø–æ–∫—Ä—ã—Ç–∏–µ/–ø–∞–¥–∞—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
- Remediation
  - –°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–∞–ª–æ–≤ (–∏–∑ –æ—Ç—á—ë—Ç–∞ CI) ‚Üí —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã —É—á–µ–±–Ω–∏–∫–∞.
